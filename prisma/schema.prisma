// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Product {
  id    Int    @id @default(autoincrement())
  name  String
  price Int

  histories History[]

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model History {
  id    Int    @id @default(autoincrement())
  name  String
  price Int

  productId Int
  product   Product  @relation(fields: [productId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

// Contract
// Keperluan:
// upload contract pertama kali -> save version dan signer (kriptografi)
// update contract -> validasi apakah signer sebelumnya masih ada di versi sebelumnya -> save version dan signer (kriptografi)

model Contract {
  id Int @id @default(autoincrement())

  contractVersions ContractVersion[]
}

model ContractVersion {
  id Int @id @default(autoincrement())

  contractId Int
  contract   Contract @relation(fields: [contractId], references: [id])

  hashFile String // path file contract (anggap sekarang store ke service cloud ex: cloudinary)

  signatureFields SignatureField[]

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model SignatureField {
  id Int @id @default(autoincrement())

  contractVersionId Int
  contractVersion   ContractVersion @relation(fields: [contractVersionId], references: [id])

  signatureField String // identifier signature field
  pdfName        String // name signature field
  pdfM           String // signing time

  subject     String? // subject of signature
  issuer      String? // issuer of signature
  cryptoOk    Boolean // crypto ok
  byteRangeOk Boolean // byte range ok
  integrityOk Boolean // integrity ok
  trustedCa   Boolean // trusted ca

  signedAt DateTime // signed at

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model AppStorage {
  id Int @id @default(autoincrement())

  hash         String @unique
  pathFile     String // path file contract (anggap sekarang store ke service cloud ex: cloudinary)
  publicId     String // public id from cloudinary
  resourceType String // resource type from cloudinary
  size         Int // size from cloudinary
  format       String // format from cloudinary

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}
